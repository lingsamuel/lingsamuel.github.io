<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Hakurei Shrine - Hakurei Shrine</title><meta property="og:title" content="Hakurei Shrine"><meta name=twitter:title content="Hakurei Shrine"><meta name=description content="Kubelet Startup Kubelet 的起始源码按照惯例位于 cmd/kubelet/kubelet.go，本质上是对 pkg/kubelet/kubelet.go 的封装。 Kubelet startup: mermaid.initialize({startOnLoad:true}); sequenceDiagram participant main as cmd/kubelet/kubelet.go participant server as cmd/kubelet/app/server.go participant kubelet as pkg/kubelet/kubelet.go participant cfg as pkg/kubelet/config/config.go participant lw as"><meta property="og:description" content="Kubelet Startup Kubelet 的起始源码按照惯例位于 cmd/kubelet/kubelet.go，本质上是对 pkg/kubelet/kubelet.go 的封装。 Kubelet startup: mermaid.initialize({startOnLoad:true}); sequenceDiagram participant main as cmd/kubelet/kubelet.go participant server as cmd/kubelet/app/server.go participant kubelet as pkg/kubelet/kubelet.go participant cfg as pkg/kubelet/config/config.go participant lw as"><meta name=twitter:description content="Kubelet Startup Kubelet 的起始源码按照惯例位于 cmd/kubelet/kubelet.go，本质上是对 pkg/kubelet/kubelet.go 的封装。 Kubelet startup: mermaid.initialize({startOnLoad:true}); sequenceDiagram participant main as …"><meta name=author content="Ling Samuel"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Hakurei Shrine","url":"https:\/\/lingsamuel.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/lingsamuel.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/lingsamuel.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/lingsamuel.github.io\/k8s\/chapter\/kubelet\/startup\/","name":""}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Ling Samuel"},"headline":"","description":"Kubelet Startup Kubelet 的起始源码按照惯例位于 cmd\/kubelet\/kubelet.go，本质上是对 pkg\/kubelet\/kubelet.go 的封装。 Kubelet startup: mermaid.initialize({startOnLoad:true}); sequenceDiagram participant main as cmd\/kubelet\/kubelet.go participant server as cmd\/kubelet\/app\/server.go participant kubelet as pkg\/kubelet\/kubelet.go participant cfg as pkg\/kubelet\/config\/config.go participant lw as","inLanguage":"en","wordCount":1675,"datePublished":"0001-01-01T00:00:00","dateModified":"0001-01-01T00:00:00","image":"https:\/\/lingsamuel.github.io\/","keywords":[""],"mainEntityOfPage":"https:\/\/lingsamuel.github.io\/k8s\/chapter\/kubelet\/startup\/","publisher":{"@type":"Organization","name":"https:\/\/lingsamuel.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/lingsamuel.github.io\/","height":60,"width":60}}}</script><meta property="og:title" content="Hakurei Shrine"><meta property="og:description" content="Kubelet Startup Kubelet 的起始源码按照惯例位于 cmd/kubelet/kubelet.go，本质上是对 pkg/kubelet/kubelet.go 的封装。 Kubelet startup: mermaid.initialize({startOnLoad:true}); sequenceDiagram participant main as cmd/kubelet/kubelet.go participant server as cmd/kubelet/app/server.go participant kubelet as pkg/kubelet/kubelet.go participant cfg as pkg/kubelet/config/config.go participant lw as"><meta property="og:url" content="https://lingsamuel.github.io/k8s/chapter/kubelet/startup/"><meta property="og:type" content="website"><meta property="og:site_name" content="Hakurei Shrine"><meta name=twitter:title content="Hakurei Shrine"><meta name=twitter:description content="Kubelet Startup Kubelet 的起始源码按照惯例位于 cmd/kubelet/kubelet.go，本质上是对 pkg/kubelet/kubelet.go 的封装。 Kubelet startup: mermaid.initialize({startOnLoad:true}); sequenceDiagram participant main as …"><meta name=twitter:card content="summary"><link href=https://lingsamuel.github.io/img/favicon.ico rel=icon type=image/x-icon><meta name=twitter:card content="summary"><meta property="og:url" content="https://lingsamuel.github.io/k8s/chapter/kubelet/startup/"><meta property="og:type" content="website"><meta property="og:site_name" content="Hakurei Shrine"><link rel=alternate href=https://lingsamuel.github.io/index.xml type=application/rss+xml title="Hakurei Shrine"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://lingsamuel.github.io/css/highlight.min.css><link rel=stylesheet href=https://lingsamuel.github.io/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><link rel=stylesheet href=https://lingsamuel.github.io/css/main.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-89095899-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body id=body><nav id=navbar class="navbar navbar-default navbar-fixed-top navbar-custom nav-bottom-border"><div class="container-fluid nav-container"><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://lingsamuel.github.io/>Hakurei Shrine</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Articles href=/page>Articles</a></li><li><a title=Reviews href=/review>Reviews</a></li><li><a title=Feeds href=/feed>Feeds</a></li><li class=navlinks-container><a class=navlinks-parent>Translations</a><div class=navlinks-children><a href=/translation/authorized>Authorized Translations</a>
<a href=/translation>Unauthorized Translations</a></div></li><li><a title="Fireside Stories" href=/story>Fireside Stories</a></li><li class=navlinks-container><a class=navlinks-parent>Books</a><div class=navlinks-children><a href=/book>Index</a><ul class="navlinks-container level-3-menu"><a href=/ class=navlinks-parent>Tech</a><div class="navlinks-children right-menu"><a href=/k8s-book>Kubernetes</a></div></ul><a href=/book/shikaiia>Shikaiia</a>
<a href=/book/black-tide-chaos>Black Tide Chaos</a>
<a href=/book/eternity-nightmare>Eternity Nightmare</a>
<a href=/book/travel-diary>Travel Diary of Kisaragi Sarasa</a><ul class="navlinks-container level-3-menu"><a href=/book/traveler-trilogy class=navlinks-parent>Traveler Trilogy</a><div class="navlinks-children right-menu"><a href=/book/breeze>Breeze</a>
<a href=/book/nightingale>Nightingale</a>
<a href=/book/windwarder>A Tale of Windwarder</a></div></ul><a href=/book/functor-fantasy>Functor Fantasy</a>
<a href=/book/gods-desire>Gods' Desire</a></div></li><li class=navlinks-container><a class=navlinks-parent>Game Design</a><div class=navlinks-children><a href=/moirae/rulebook/moiraerulebook>Project Moirae</a>
<a href=/no-mans-land>No Man's Land</a></div></li><li class=navlinks-container><a class=navlinks-parent>Projects</a><div class=navlinks-children><a href=/nesoi>Nesoi</a>
<a href=/nox>Nox</a>
<a href=https://github.com/lingsamuel/Nymph>Nymph</a>
<a href=/page/return-to-skyrim>Return to Skyrim</a></div></li><li><a title=About href=/about>About</a></li><li><a title=Categories href=/categories>Categories</a></li><li><a title=Tags href=/tags>Tags</a></li><li class=navlinks-container><a class=navlinks-parent>Language</a><div class=navlinks-children><a href=/zh-cn lang=zh-cn>zh-cn</a>
<a href=/zh-tw lang=zh-tw>zh-tw</a></div></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><div id=intro-header class=intro-header></div><div class=container id=mainContainer role=main><div class=row><div class="col-lg-8 col-lg-offset-1"><article role=main class=blog-post><h1 id=kubelet-startup>Kubelet Startup</h1><p>Kubelet 的起始源码按照惯例位于 <code>cmd/kubelet/kubelet.go</code>，本质上是对 <code>pkg/kubelet/kubelet.go</code> 的封装。</p><p>Kubelet startup:</p><link href=/css/mermaid.css type=text/css rel=stylesheet><script defer src=/js/mermaid.min.js>mermaid.initialize({startOnLoad:true});</script><div class=mermaid align=center>sequenceDiagram
participant main as cmd/kubelet/kubelet.go
participant server as cmd/kubelet/app/server.go
participant kubelet as pkg/kubelet/kubelet.go
participant cfg as pkg/kubelet/config/config.go
participant lw as ListAndWatch
main-->>server: NewKubeletCommand()
server-->>server: Run()
server-->>server: RunKubelet()
server-->>server: createAndInitKubelet()
server-->>+kubelet: NewMainKubelet()
kubelet-->>+cfg: NewPodConfig()
cfg-->>+lw: NewSourceApiserver()
lw-->>-cfg: Channel
cfg-->>-kubelet: *PodConfig
kubelet-->>-server: *Kubelet
#server-->>kubelet: StartGarbageCollection
server-->>server: startKubelet()
server-->>kubelet: go Run()
par loop Events from *PodConfig
lw-->>kubelet: Events
kubelet-->>kubelet: syncLoop
end
server-->>kubelet: go ListenAndServe()</div><p>Kubelet 的核心组件（在 <code>NewMainKubelet</code> 中初始化）包括但不限于：</p><ul><li>kubelet<ul><li>SharedInformer</li><li>Indexer</li><li>NodeLister</li><li>ServiceLister</li><li>ListWatch</li><li>ProbeManager<ul><li>StatusManager</li><li>LivenessManager</li><li>StartupManager</li></ul></li><li>PodManager</li><li>Runtime (NewKubeGenericRuntimeManager)</li><li>PLEG</li><li>ContainerGC</li><li>ImageGCManager</li><li>CertificateManager</li><li>TokenManager</li><li>PluginManager</li><li>VolumeManager</li><li>PodWorkers</li><li>PodKiller</li><li>EvictionManager</li><li>PodAdmitHandler</li><li>PodSyncLoopHandler (ActiveDeadlineHandler)</li><li>PodSyncHandler (ActiveDeadlineHandler)</li></ul></li></ul><h2 id=run>Run</h2><p><code>Run</code> 函数启动 kublet 的核心功能：处理配置更新。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// Run starts the kubelet reacting to config updates
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>kl</span> <span class=o>*</span><span class=nx>Kubelet</span><span class=p>)</span> <span class=nf>Run</span><span class=p>(</span><span class=nx>updates</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=nx>kubetypes</span><span class=p>.</span><span class=nx>PodUpdate</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>kl</span><span class=p>.</span><span class=nx>imageManager</span><span class=p>.</span><span class=nf>Start</span><span class=p>()</span>
  <span class=nx>kl</span><span class=p>.</span><span class=nx>serverCertificateManager</span><span class=p>.</span><span class=nf>Start</span><span class=p>()</span>
  <span class=nx>kl</span><span class=p>.</span><span class=nx>oomWatcher</span><span class=p>.</span><span class=nf>Start</span><span class=p>(</span><span class=nx>kl</span><span class=p>.</span><span class=nx>nodeRef</span><span class=p>)</span>
  <span class=nx>kl</span><span class=p>.</span><span class=nx>resourceAnalyzer</span><span class=p>.</span><span class=nf>Start</span><span class=p>()</span>
  <span class=k>go</span> <span class=nx>kl</span><span class=p>.</span><span class=nx>volumeManager</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>kl</span><span class=p>.</span><span class=nx>sourcesReady</span><span class=p>,</span> <span class=nx>wait</span><span class=p>.</span><span class=nx>NeverStop</span><span class=p>)</span>
  <span class=k>go</span> <span class=nx>wait</span><span class=p>.</span><span class=nf>Until</span><span class=p>(</span><span class=nx>kl</span><span class=p>.</span><span class=nx>syncNodeStatus</span><span class=p>,</span> <span class=nx>kl</span><span class=p>.</span><span class=nx>nodeStatusUpdateFrequency</span><span class=p>,</span> <span class=nx>wait</span><span class=p>.</span><span class=nx>NeverStop</span><span class=p>)</span>
  <span class=k>go</span> <span class=nx>kl</span><span class=p>.</span><span class=nf>fastStatusUpdateOnce</span><span class=p>()</span>
  <span class=k>go</span> <span class=nx>kl</span><span class=p>.</span><span class=nx>nodeLeaseController</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>wait</span><span class=p>.</span><span class=nx>NeverStop</span><span class=p>)</span>
  <span class=k>go</span> <span class=nx>wait</span><span class=p>.</span><span class=nf>Until</span><span class=p>(</span><span class=nx>kl</span><span class=p>.</span><span class=nx>updateRuntimeUp</span><span class=p>,</span> <span class=mi>5</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span> <span class=nx>wait</span><span class=p>.</span><span class=nx>NeverStop</span><span class=p>)</span>
  <span class=nx>kl</span><span class=p>.</span><span class=nf>initNetworkUtil</span><span class=p>()</span>
  <span class=c1>// Start a goroutine responsible for killing pods (that are not properly
</span><span class=c1></span>  <span class=c1>// handled by pod workers).
</span><span class=c1></span>  <span class=k>go</span> <span class=nx>wait</span><span class=p>.</span><span class=nf>Until</span><span class=p>(</span><span class=nx>kl</span><span class=p>.</span><span class=nx>podKiller</span><span class=p>.</span><span class=nx>PerformPodKillingWork</span><span class=p>,</span> <span class=mi>1</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span> <span class=nx>wait</span><span class=p>.</span><span class=nx>NeverStop</span><span class=p>)</span>
  <span class=c1>// Start component sync loops.
</span><span class=c1></span>  <span class=nx>kl</span><span class=p>.</span><span class=nx>statusManager</span><span class=p>.</span><span class=nf>Start</span><span class=p>()</span>
  <span class=nx>kl</span><span class=p>.</span><span class=nx>probeManager</span><span class=p>.</span><span class=nf>Start</span><span class=p>()</span>
  <span class=nx>kl</span><span class=p>.</span><span class=nx>runtimeClassManager</span><span class=p>.</span><span class=nf>Start</span><span class=p>(</span><span class=nx>wait</span><span class=p>.</span><span class=nx>NeverStop</span><span class=p>)</span>
  <span class=c1>// Start the pod lifecycle event generator.
</span><span class=c1></span>  <span class=nx>kl</span><span class=p>.</span><span class=nx>pleg</span><span class=p>.</span><span class=nf>Start</span><span class=p>()</span>
  
  <span class=nx>kl</span><span class=p>.</span><span class=nf>syncLoop</span><span class=p>(</span><span class=nx>updates</span><span class=p>,</span> <span class=nx>kl</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>各个 manager 的启动与 iptables 的配置暂时可以略过。重点关注 <code>syncLoop</code> 函数。这是 kubelet 的核心函数。</p><h2 id=syncloop>syncLoop</h2><p>在 <code>syncLoop</code> 最后的 for 循环里，调用了 <code>syncLoopIteration</code> 函数：</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=p>(</span><span class=nx>kl</span> <span class=o>*</span><span class=nx>Kubelet</span><span class=p>)</span> <span class=nf>syncLoopIteration</span><span class=p>(</span><span class=nx>configCh</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=nx>kubetypes</span><span class=p>.</span><span class=nx>PodUpdate</span><span class=p>,</span> <span class=nx>handler</span> <span class=nx>SyncHandler</span><span class=p>,</span>
  <span class=nx>syncCh</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>,</span> <span class=nx>housekeepingCh</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>,</span> <span class=nx>plegCh</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=o>*</span><span class=nx>pleg</span><span class=p>.</span><span class=nx>PodLifecycleEvent</span><span class=p>)</span> <span class=kt>bool</span>
</code></pre></div><p>参数 <code>configCh</code> 是接收配置更新的 channel，后续配置的变更都从这个 channel 读取。<code>syncCh</code> 和 <code>housekeepingCh</code> 是定时触发的同步事件。</p><p>此外，函数还从 <code>livenessManager</code> 里读取事件。</p><p>参数 <code>handler</code> 是对 Pod 进行操作的具体的实现，此处传递进来的就是 <code>kl: Kubelet</code> 自身。</p><h3 id=synchandler>SyncHandler</h3><p>总的来说，所有的事件都是 <code>SyncHandler</code> 这个接口的实现处理的，以 <code>HandlePodUpdates</code> 为例：</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// HandlePodUpdates is the callback in the SyncHandler interface for pods
</span><span class=c1>// being updated from a config source.
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>kl</span> <span class=o>*</span><span class=nx>Kubelet</span><span class=p>)</span> <span class=nf>HandlePodUpdates</span><span class=p>(</span><span class=nx>pods</span> <span class=p>[]</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>start</span> <span class=o>:=</span> <span class=nx>kl</span><span class=p>.</span><span class=nx>clock</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
  <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>pod</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>pods</span> <span class=p>{</span>
    <span class=nx>kl</span><span class=p>.</span><span class=nx>podManager</span><span class=p>.</span><span class=nf>UpdatePod</span><span class=p>(</span><span class=nx>pod</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>kubetypes</span><span class=p>.</span><span class=nf>IsMirrorPod</span><span class=p>(</span><span class=nx>pod</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>kl</span><span class=p>.</span><span class=nf>handleMirrorPod</span><span class=p>(</span><span class=nx>pod</span><span class=p>,</span> <span class=nx>start</span><span class=p>)</span>
      <span class=k>continue</span>
    <span class=p>}</span>
    <span class=nx>mirrorPod</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>kl</span><span class=p>.</span><span class=nx>podManager</span><span class=p>.</span><span class=nf>GetMirrorPodByPod</span><span class=p>(</span><span class=nx>pod</span><span class=p>)</span>
    <span class=nx>kl</span><span class=p>.</span><span class=nf>dispatchWork</span><span class=p>(</span><span class=nx>pod</span><span class=p>,</span> <span class=nx>kubetypes</span><span class=p>.</span><span class=nx>SyncPodUpdate</span><span class=p>,</span> <span class=nx>mirrorPod</span><span class=p>,</span> <span class=nx>start</span><span class=p>)</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p><code>Kubelet.SyncHandler</code> 的函数实现，除了 <code>HandlePodRemoves</code> 之外，最终都会调用 <code>dispatchWork</code>，而这个函数会将请求派发给 <code>statusManager.TerminatePod</code> 或 <code>podWorkers.UpdatePod</code> 进行处理。</p><h4 id=statusmanagerterminatepod>StatusManager.TerminatePod</h4><p><code>TerminatePod</code> 会将请求发送给 <code>podStatusChannel</code> 这个 channel。</p><p>在 <code>StatusManager.Start</code> 中，会不断读取这个 channel，调用 <code>syncPod</code> 处理。</p><p>注意此处的 <code>syncPod</code> 与 <code>Kubelet.syncPod</code> 不是同一个函数。因为 StatusManager 只负责处理 Status 相关的数据。这个函数最终会调用 <code>util.PatchPodStatus</code>，通过 client API 发送 Patch 请求。如果 pod 可以被删除，它还会发送 Delete 请求。</p><h4 id=podworkersupdatepod>PodWorkers.UpdatePod</h4><p><code>PodWorkers.UpdatePod</code> 会根据 Pod 的 uid 启动一个 <code>managePodLoop</code> 的 goroutine，监听 <code>podUpdates &lt;-chan UpdatePodOptions</code> 这个 channel。随后将更新的信息传递给 <code>podUpdates</code> 这个 channel。</p><p>在 <code>managePodLoop</code>，它又会调用 <code>syncPodFn</code>。而 <code>syncPodFn</code> 是在建立 PodWorker 时传递进来的，实际上是 <code>Kubelet.syncPod</code>。</p><h3 id=kubeletsyncpod>Kubelet.syncPod</h3><p>Kubelet.syncPod 会调用一堆函数，包括生成各种事件、更新 Status、kill 掉不应该运行的 pod、创建目录、mount volume、同步 secret、调用容器 runtime 的 <code>SyncPod</code>，等。</p><h2 id=configch>configCh</h2><p>除了定时任务和 PLEG 事件外，<code>syncLoopIteration</code> 的事件均来自 <code>configCh</code>。</p><p>那么，<code>configCh</code> 从何而来？追溯一下调用栈：</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// kubelet/app/server.go
</span><span class=c1></span><span class=kd>func</span> <span class=nf>RunKubelet</span><span class=p>(</span><span class=nx>kubeServer</span> <span class=o>*</span><span class=nx>options</span><span class=p>.</span><span class=nx>KubeletServer</span><span class=p>,</span> <span class=nx>kubeDeps</span> <span class=o>*</span><span class=nx>kubelet</span><span class=p>.</span><span class=nx>Dependencies</span><span class=p>,</span> <span class=nx>runOnce</span> <span class=kt>bool</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
  <span class=c1>// NewMainKubelet should have set up a pod source config if one didn&#39;t exist
</span><span class=c1></span>  <span class=c1>// when the builder was run. This is just a precaution.
</span><span class=c1></span>  <span class=k>if</span> <span class=nx>kubeDeps</span><span class=p>.</span><span class=nx>PodConfig</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to create kubelet, pod source config was nil&#34;</span><span class=p>)</span>
  <span class=p>}</span>
  <span class=nx>podCfg</span> <span class=o>:=</span> <span class=nx>kubeDeps</span><span class=p>.</span><span class=nx>PodConfig</span>
  <span class=nf>startKubelet</span><span class=p>(</span><span class=nx>k</span><span class=p>,</span> <span class=nx>podCfg</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>kubeServer</span><span class=p>.</span><span class=nx>KubeletConfiguration</span><span class=p>,</span> <span class=nx>kubeDeps</span><span class=p>,</span> <span class=nx>kubeServer</span><span class=p>.</span><span class=nx>EnableCAdvisorJSONEndpoints</span><span class=p>,</span> <span class=nx>kubeServer</span><span class=p>.</span><span class=nx>EnableServer</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>startKubelet</span><span class=p>(</span><span class=nx>k</span> <span class=nx>kubelet</span><span class=p>.</span><span class=nx>Bootstrap</span><span class=p>,</span> <span class=nx>podCfg</span> <span class=o>*</span><span class=nx>config</span><span class=p>.</span><span class=nx>PodConfig</span><span class=p>,</span> <span class=nx>kubeCfg</span> <span class=o>*</span><span class=nx>kubeletconfiginternal</span><span class=p>.</span><span class=nx>KubeletConfiguration</span><span class=p>,</span> <span class=nx>kubeDeps</span> <span class=o>*</span><span class=nx>kubelet</span><span class=p>.</span><span class=nx>Dependencies</span><span class=p>,</span> <span class=nx>enableCAdvisorJSONEndpoints</span><span class=p>,</span> <span class=nx>enableServer</span> <span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>go</span> <span class=nx>k</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>podCfg</span><span class=p>.</span><span class=nf>Updates</span><span class=p>())</span>
</code></pre></div><p>从注释中也可以看出，实际上，<code>kubeDeps.PodConfig</code> 的初始化来源于 <code>pkg</code> 中的 <code>NewMainKubelet</code> 函数：</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>/// pkg/kubelet/kubelet.go
</span><span class=c1></span><span class=kd>func</span> <span class=nf>NewMainKubelet</span><span class=p>(</span><span class=nx>kubeCfg</span> <span class=o>*</span><span class=nx>kubeletconfiginternal</span><span class=p>.</span><span class=nx>KubeletConfiguration</span><span class=p>,</span>
  <span class=nx>kubeDeps</span> <span class=o>*</span><span class=nx>Dependencies</span><span class=p>,</span>
  <span class=o>...</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>if</span> <span class=nx>kubeDeps</span><span class=p>.</span><span class=nx>PodConfig</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nx>err</span> <span class=kt>error</span>
    <span class=nx>kubeDeps</span><span class=p>.</span><span class=nx>PodConfig</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nf>makePodSourceConfig</span><span class=p>(</span><span class=nx>kubeCfg</span><span class=p>,</span> <span class=nx>kubeDeps</span><span class=p>,</span> <span class=nx>nodeName</span><span class=p>)</span>
    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
      <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// makePodSourceConfig creates a config.PodConfig from the given
</span><span class=c1>// KubeletConfiguration or returns an error.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>makePodSourceConfig</span><span class=p>(</span><span class=nx>kubeCfg</span> <span class=o>*</span><span class=nx>kubeletconfiginternal</span><span class=p>.</span><span class=nx>KubeletConfiguration</span><span class=p>,</span> <span class=nx>kubeDeps</span> <span class=o>*</span><span class=nx>Dependencies</span><span class=p>,</span> <span class=nx>nodeName</span> <span class=nx>types</span><span class=p>.</span><span class=nx>NodeName</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>config</span><span class=p>.</span><span class=nx>PodConfig</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// source of all configuration
</span><span class=c1></span>  <span class=nx>cfg</span> <span class=o>:=</span> <span class=nx>config</span><span class=p>.</span><span class=nf>NewPodConfig</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>PodConfigNotificationIncremental</span><span class=p>,</span> <span class=nx>kubeDeps</span><span class=p>.</span><span class=nx>Recorder</span><span class=p>)</span>

  <span class=k>if</span> <span class=nx>kubeDeps</span><span class=p>.</span><span class=nx>KubeClient</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=nx>klog</span><span class=p>.</span><span class=nf>Infof</span><span class=p>(</span><span class=s>&#34;Watching apiserver&#34;</span><span class=p>)</span>
    <span class=nx>config</span><span class=p>.</span><span class=nf>NewSourceApiserver</span><span class=p>(</span><span class=nx>kubeDeps</span><span class=p>.</span><span class=nx>KubeClient</span><span class=p>,</span> <span class=nx>nodeName</span><span class=p>,</span> <span class=nx>cfg</span><span class=p>.</span><span class=nf>Channel</span><span class=p>(</span><span class=nx>kubetypes</span><span class=p>.</span><span class=nx>ApiserverSource</span><span class=p>))</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=nx>cfg</span><span class=p>,</span> <span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div><p>在 <code>makePodSourceConfig</code> 中，<code>NewPodConfig</code> 就生成了最后使用到的 channel。</p><p>但实际上我们看到 <code>newSourceApiserverFromLW</code> 中，实际写入的 channel 是 <code>cfg.Channel(kubetypes.ApiserverSource)</code>，而不是 <code>PodConfig.Updates()</code>。</p><h3 id=podconfig>PodConfig</h3><p>函数 <code>cfg.Channel(source)</code> 里实际工作的是 <code>PodConfig.mux.Channel</code> 这个函数。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// pkg/kubelet/config/config.go
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>PodConfig</span><span class=p>)</span> <span class=nf>Channel</span><span class=p>(</span><span class=nx>source</span> <span class=kt>string</span><span class=p>)</span> <span class=kd>chan</span><span class=o>&lt;-</span> <span class=kd>interface</span><span class=p>{}</span> <span class=p>{</span>
  <span class=nx>c</span><span class=p>.</span><span class=nx>sourcesLock</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
  <span class=k>defer</span> <span class=nx>c</span><span class=p>.</span><span class=nx>sourcesLock</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
  <span class=nx>c</span><span class=p>.</span><span class=nx>sources</span><span class=p>.</span><span class=nf>Insert</span><span class=p>(</span><span class=nx>source</span><span class=p>)</span>
  <span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nx>mux</span><span class=p>.</span><span class=nf>Channel</span><span class=p>(</span><span class=nx>source</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p><code>mux.Channel</code> 为每个 source 创建一个 channel，并监听这个 channel 的变动，然后调用 <code>merger.Merge</code> 将所有 channel 的变动合并起来。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// pkg/util/config/config.go
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>Mux</span><span class=p>)</span> <span class=nf>Channel</span><span class=p>(</span><span class=nx>source</span> <span class=kt>string</span><span class=p>)</span> <span class=kd>chan</span> <span class=kd>interface</span><span class=p>{}</span> <span class=p>{</span>
  <span class=nx>m</span><span class=p>.</span><span class=nx>sourceLock</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
  <span class=k>defer</span> <span class=nx>m</span><span class=p>.</span><span class=nx>sourceLock</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
  <span class=nx>channel</span><span class=p>,</span> <span class=nx>exists</span> <span class=o>:=</span> <span class=nx>m</span><span class=p>.</span><span class=nx>sources</span><span class=p>[</span><span class=nx>source</span><span class=p>]</span>
  <span class=k>if</span> <span class=nx>exists</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>channel</span>
  <span class=p>}</span>
  <span class=nx>newChannel</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kd>interface</span><span class=p>{})</span>
  <span class=nx>m</span><span class=p>.</span><span class=nx>sources</span><span class=p>[</span><span class=nx>source</span><span class=p>]</span> <span class=p>=</span> <span class=nx>newChannel</span>
  <span class=k>go</span> <span class=nx>wait</span><span class=p>.</span><span class=nf>Until</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span> <span class=nx>m</span><span class=p>.</span><span class=nf>listen</span><span class=p>(</span><span class=nx>source</span><span class=p>,</span> <span class=nx>newChannel</span><span class=p>)</span> <span class=p>},</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>wait</span><span class=p>.</span><span class=nx>NeverStop</span><span class=p>)</span>
  <span class=k>return</span> <span class=nx>newChannel</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>Mux</span><span class=p>)</span> <span class=nf>listen</span><span class=p>(</span><span class=nx>source</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>listenChannel</span> <span class=o>&lt;-</span><span class=kd>chan</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>{</span>
  <span class=k>for</span> <span class=nx>update</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>listenChannel</span> <span class=p>{</span>
    <span class=nx>m</span><span class=p>.</span><span class=nx>merger</span><span class=p>.</span><span class=nf>Merge</span><span class=p>(</span><span class=nx>source</span><span class=p>,</span> <span class=nx>update</span><span class=p>)</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>创建 <code>PodConfig</code> 的时候就通过 <code>newPodStorage</code> 创建了 <code>mux.merger</code>。可以看到创建 <code>PodStorage</code> 的 <code>updates</code> 与 <code>PodConfig.updates</code> 是同一个变量。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// pkg/kubelet/config/config.go
</span><span class=c1>// NewPodConfig creates an object that can merge many configuration sources into a stream
</span><span class=c1>// of normalized updates to a pod configuration.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>NewPodConfig</span><span class=p>(</span><span class=nx>mode</span> <span class=nx>PodConfigNotificationMode</span><span class=p>,</span> <span class=nx>recorder</span> <span class=nx>record</span><span class=p>.</span><span class=nx>EventRecorder</span><span class=p>)</span> <span class=o>*</span><span class=nx>PodConfig</span> <span class=p>{</span>
  <span class=nx>updates</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=nx>kubetypes</span><span class=p>.</span><span class=nx>PodUpdate</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
  <span class=nx>storage</span> <span class=o>:=</span> <span class=nf>newPodStorage</span><span class=p>(</span><span class=nx>updates</span><span class=p>,</span> <span class=nx>mode</span><span class=p>,</span> <span class=nx>recorder</span><span class=p>)</span>
  <span class=nx>podConfig</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>PodConfig</span><span class=p>{</span>
    <span class=nx>pods</span><span class=p>:</span>    <span class=nx>storage</span><span class=p>,</span>
    <span class=nx>mux</span><span class=p>:</span>     <span class=nx>config</span><span class=p>.</span><span class=nf>NewMux</span><span class=p>(</span><span class=nx>storage</span><span class=p>),</span>
    <span class=nx>updates</span><span class=p>:</span> <span class=nx>updates</span><span class=p>,</span>
    <span class=nx>sources</span><span class=p>:</span> <span class=nx>sets</span><span class=p>.</span><span class=nx>String</span><span class=p>{},</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=nx>podConfig</span>
<span class=p>}</span>
</code></pre></div><p><code>PodStorage.Merge</code> 保证了消息传递的顺序，并且还过滤了重复的消息。</p><h2 id=listandwatch>ListAndWatch</h2><p>在 <code>NewSourceApiserver</code> 机制中，利用了 <code>client-go</code> 的 List and Watch 机制不断接收消息。相关稍后再议。</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// pkg/kubelet/config/apiserver.go
</span><span class=c1>// NewSourceApiserver creates a config source that watches and pulls from the apiserver.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>NewSourceApiserver</span><span class=p>(</span><span class=nx>c</span> <span class=nx>clientset</span><span class=p>.</span><span class=nx>Interface</span><span class=p>,</span> <span class=nx>nodeName</span> <span class=nx>types</span><span class=p>.</span><span class=nx>NodeName</span><span class=p>,</span> <span class=nx>updates</span> <span class=kd>chan</span><span class=o>&lt;-</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>{</span>
	<span class=nx>lw</span> <span class=o>:=</span> <span class=nx>cache</span><span class=p>.</span><span class=nf>NewListWatchFromClient</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nf>CoreV1</span><span class=p>().</span><span class=nf>RESTClient</span><span class=p>(),</span> <span class=s>&#34;pods&#34;</span><span class=p>,</span> <span class=nx>metav1</span><span class=p>.</span><span class=nx>NamespaceAll</span><span class=p>,</span> <span class=nx>fields</span><span class=p>.</span><span class=nf>OneTermEqualSelector</span><span class=p>(</span><span class=nx>api</span><span class=p>.</span><span class=nx>PodHostField</span><span class=p>,</span> <span class=nb>string</span><span class=p>(</span><span class=nx>nodeName</span><span class=p>)))</span>
	<span class=nf>newSourceApiserverFromLW</span><span class=p>(</span><span class=nx>lw</span><span class=p>,</span> <span class=nx>updates</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// newSourceApiserverFromLW holds creates a config source that watches and pulls from the apiserver.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>newSourceApiserverFromLW</span><span class=p>(</span><span class=nx>lw</span> <span class=nx>cache</span><span class=p>.</span><span class=nx>ListerWatcher</span><span class=p>,</span> <span class=nx>updates</span> <span class=kd>chan</span><span class=o>&lt;-</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>{</span>
	<span class=nx>send</span> <span class=o>:=</span> <span class=kd>func</span><span class=p>(</span><span class=nx>objs</span> <span class=p>[]</span><span class=kd>interface</span><span class=p>{})</span> <span class=p>{</span>
		<span class=kd>var</span> <span class=nx>pods</span> <span class=p>[]</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span>
		<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>o</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>objs</span> <span class=p>{</span>
			<span class=nx>pods</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>pods</span><span class=p>,</span> <span class=nx>o</span><span class=p>.(</span><span class=o>*</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>))</span>
		<span class=p>}</span>
		<span class=nx>updates</span> <span class=o>&lt;-</span> <span class=nx>kubetypes</span><span class=p>.</span><span class=nx>PodUpdate</span><span class=p>{</span><span class=nx>Pods</span><span class=p>:</span> <span class=nx>pods</span><span class=p>,</span> <span class=nx>Op</span><span class=p>:</span> <span class=nx>kubetypes</span><span class=p>.</span><span class=nx>SET</span><span class=p>,</span> <span class=nx>Source</span><span class=p>:</span> <span class=nx>kubetypes</span><span class=p>.</span><span class=nx>ApiserverSource</span><span class=p>}</span>
	<span class=p>}</span>
	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>cache</span><span class=p>.</span><span class=nf>NewReflector</span><span class=p>(</span><span class=nx>lw</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Pod</span><span class=p>{},</span> <span class=nx>cache</span><span class=p>.</span><span class=nf>NewUndeltaStore</span><span class=p>(</span><span class=nx>send</span><span class=p>,</span> <span class=nx>cache</span><span class=p>.</span><span class=nx>MetaNamespaceKeyFunc</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span>
	<span class=k>go</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>wait</span><span class=p>.</span><span class=nx>NeverStop</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><div id=refContainer></div></article><ul class="pager blog-pager"><li class=previous><a href=https://lingsamuel.github.io/k8s/chapter/readme/ data-toggle=tooltip data-placement=top>&larr; Previous Post</a></li><li class=next><a href=https://lingsamuel.github.io/k8s/chapter/informer/ data-toggle=tooltip data-placement=top>Next Post &rarr;</a></li></ul></div><aside id=toc class=col-lg-2><nav id=TableOfContents><ul><li><a href=#run>Run</a></li><li><a href=#syncloop>syncLoop</a><ul><li><a href=#synchandler>SyncHandler</a></li><li><a href=#kubeletsyncpod>Kubelet.syncPod</a></li></ul></li><li><a href=#configch>configCh</a><ul><li><a href=#podconfig>PodConfig</a></li></ul></li><li><a href=#listandwatch>ListAndWatch</a></li></ul></nav></aside></div></div><footer><div class=container><div class=row><div class="col-lg-10 col-lg-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:lingsamuelgrace@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/lingsamuel title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://lingsamuel.github.io/index.xml title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=lingsamuel.github.io>Ling Samuel</a>
&nbsp;&bull;&nbsp;&copy;
2020
&nbsp;&bull;&nbsp;
<a href=https://lingsamuel.github.io/>Hakurei Shrine</a></p><p class="credits theme-by text-muted"><a href=http://gohugo.io>Hugo v0.78.0</a> powered &nbsp;&bull;&nbsp; Theme by <a href=http://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a> adapted to <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> Modified by <a href=https://github.com/lingsamuel>LingSamuel</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://lingsamuel.github.io/js/main.js></script><script src=https://lingsamuel.github.io/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0");});</script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://lingsamuel.github.io/js/load-photoswipe.js></script></body></html>